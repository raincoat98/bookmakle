import{initializeApp as w}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";import{getAuth as k,GoogleAuthProvider as E,onAuthStateChanged as O,signInWithPopup as h,signOut as A}from"https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const g of a.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&o(g)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();const b={apiKey:"AIzaSyA-biD6_Gy0sGWoy2qmcB-sXuW5strHApc",authDomain:"bookmarkhub-5ea6c.firebaseapp.com",projectId:"bookmarkhub-5ea6c",storageBucket:"bookmarkhub-5ea6c.firebasestorage.app",messagingSenderId:"798364806000",appId:"1:798364806000:web:d6b0061a2f52feaafdfdb5",measurementId:"G-QHL5WTDJE7"};console.log("Initializing Firebase with config:",b);const M=w(b),d=k(M),f=new E;f.setCustomParameters({prompt:"select_account"});console.log("Firebase Auth initialized:",d);const l=document.getElementById("status"),i=document.getElementById("signin-btn"),c=document.getElementById("signout-btn"),p=document.getElementById("user-info");O(d,e=>{console.log("Auth state changed:",e),e?(l.textContent="로그인됨",l.className="status authenticated",i.style.display="none",c.style.display="inline-block",p.style.display="block",p.innerHTML=`
      <img src="${e.photoURL||"https://via.placeholder.com/50"}" alt="프로필">
      <strong>${e.displayName}</strong><br>
      <small>${e.email}</small>
    `):(l.textContent="로그아웃됨",l.className="status unauthenticated",i.style.display="inline-block",c.style.display="none",p.style.display="none")});i.addEventListener("click",async()=>{console.log("Manual sign-in button clicked");try{i.disabled=!0,i.textContent="로그인 중...";const e=await h(d,f);console.log("Manual sign-in successful:",e)}catch(e){console.error("Manual sign-in error:",e),l.textContent=`로그인 실패: ${e.message}`,l.className="status unauthenticated"}finally{i.disabled=!1,i.textContent="Google로 로그인"}});c.addEventListener("click",async()=>{console.log("Manual sign-out button clicked");try{c.disabled=!0,c.textContent="로그아웃 중...",await A(d),console.log("Manual sign-out successful")}catch(e){console.error("Manual sign-out error:",e)}finally{c.disabled=!1,c.textContent="로그아웃"}});let s=null,u=!1;function S(){try{document.location.ancestorOrigins&&document.location.ancestorOrigins.length>0?(s=document.location.ancestorOrigins[0],console.log("Found parent frame from ancestorOrigins:",s)):window.parent&&window.parent!==window?(s=window.location.origin,console.log("Found parent frame from window.parent:",s)):console.log("No parent frame detected, running in standalone mode")}catch(e){console.error("Error finding parent frame:",e)}}console.log("Current location:",window.location.href);console.log("Ancestor origins:",document.location.ancestorOrigins);S();function m(e){if(s)try{if(console.log("Attempting to send response to parent:",{parentFrame:s,result:e,timestamp:new Date().toISOString()}),e&&e.user){const n={user:{uid:e.user.uid,email:e.user.email,displayName:e.user.displayName,photoURL:e.user.photoURL,emailVerified:e.user.emailVerified}};console.log("Sending success response:",n);for(let o=0;o<3;o++)try{window.parent.postMessage(JSON.stringify(n),s),console.log(`Success response sent (attempt ${o+1})`);break}catch(t){if(console.error(`Failed to send success response (attempt ${o+1}):`,t),o===2)throw t}}else{const n={error:(e==null?void 0:e.message)||(e==null?void 0:e.code)||"알 수 없는 오류가 발생했습니다."};console.log("Sending error response:",n);for(let o=0;o<3;o++)try{window.parent.postMessage(JSON.stringify(n),s),console.log(`Error response sent (attempt ${o+1})`);break}catch(t){if(console.error(`Failed to send error response (attempt ${o+1}):`,t),o===2)throw t}}}catch(r){console.error("Error sending response:",r);const n={error:"응답 전송 중 오류가 발생했습니다."};window.parent.postMessage(JSON.stringify(n),s)}else console.log("No parent frame detected, running in standalone mode")}function y(){if(s)try{console.log("Sending ready message to parent frame"),window.parent.postMessage(JSON.stringify({ready:!0}),s),console.log("Ready message sent successfully")}catch(e){console.error("Could not send ready message to parent frame:",e)}}window.addEventListener("message",async function({data:e,origin:r}){if(console.log("Received message:",{data:e,origin:r,parentFrame:s,isExpectedOrigin:r===s,timestamp:new Date().toISOString()}),r!==s){console.log("Ignoring message from unauthorized origin:",r,"Expected:",s);return}if(e.initAuth){if(console.log("Received initAuth request"),u){console.log("Auth request already in progress, ignoring");return}u=!0;try{const n=d.currentUser;if(n){console.log("User already authenticated:",n),m({user:n}),u=!1;return}console.log("Starting new authentication process");const o=await h(d,f);console.log("Authentication successful:",o),m(o)}catch(n){console.error("Chrome Extension 인증 오류:",n);let o="인증 중 오류가 발생했습니다.";switch(n.code){case"auth/popup-closed-by-user":o="로그인 창이 닫혔습니다.";break;case"auth/popup-blocked":o="팝업이 차단되었습니다. 팝업 차단을 해제해주세요.";break;case"auth/cancelled-popup-request":o="로그인이 취소되었습니다.";break;case"auth/network-request-failed":o="네트워크 연결을 확인해주세요.";break;case"auth/too-many-requests":o="너무 많은 요청이 발생했습니다. 잠시 후 다시 시도해주세요.";break;case"auth/user-disabled":o="비활성화된 계정입니다.";break;case"auth/invalid-email":o="잘못된 이메일 주소입니다.";break;case"auth/operation-not-allowed":o="Google 로그인이 비활성화되어 있습니다.";break;case"auth/unauthorized-domain":o="이 도메인에서 인증이 허용되지 않습니다.";break;default:o=n.message||"알 수 없는 인증 오류가 발생했습니다."}m({error:o})}finally{u=!1}}});window.addEventListener("load",()=>{console.log("Firebase auth page loaded and ready"),y()});document.addEventListener("DOMContentLoaded",()=>{console.log("Firebase auth page DOM loaded"),y()});setTimeout(()=>{console.log("Sending delayed ready message"),y()},1e3);console.log("Firebase auth script loaded completely");
